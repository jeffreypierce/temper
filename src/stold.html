<!DOCTYPE html public "-//W3C//DTD HTML 4.01 Transitional//EN">
<HEAD>
<TITLE>Musical Calculator</TITLE>
<SCRIPT>
var homeKey = 12;
var tuning = 0;
var relTuning = 0;
var relType = 0  // 0=self, 1=relative to Equal Temperament, 2=relative to another temperament, 3=relative to Natural Tuning
var scaleType = 0;
var display = 3;

var keyName = new Array ('Dbb','Abb','Ebb','Bbb','Fb','Cb','Gb','Db','Ab','Eb','Bb','F','C','G','D','A','E','B','F#','C#','G#','D#','A#','E#','B#');
var sharpName = new Array('C','C#','D','D#','E','F','F#','G','G#','A','A#','B');
var flatName = new Array('C','Db','D','Eb','E','F','Gb','G','Ab','A','Bb','B');
var scaleName = new Array('Major','Minor','Chromatic');
var fgcolor = new Array('#FFFFFF"','#000000"','#000000"');
var color = new Array('000000','000099','0000CC','0000FF','0033FF','0066FF','00CCFF','00FF00','FF0000','FF3300','FF6600','FF9900','FFCC00','FFFF00','FFFFFF');

var scaleArray = new Array(3);
scaleArray[0] = new Array(0,0,0,2,2,4,4,5,5,7,7,9,9,11,11,12,12); // major
scaleArray[1] = new Array(0,0,0,2,2,3,3,5,5,7,7,8,8,11,11,12,12); // minor
scaleArray[2] = new Array (0,0,0,1,2,3,4,5,6,7,7,8,9,10,11,12,12);  // chromatic

var columnTitle = new Array(3);
columnTitle[0] = new Array('1','1','1','M2','M2','M3','M3','4','4','5','5','M6','M6','M7','M7','8','8');  // major
columnTitle[1] = new Array('1','1','1','M2','M2','m3','m3','4','4','5','5','m6','m6','M7','M7','8','8');  // minor
columnTitle[2] = new Array ('1','1','1','m2','M2','m3','M3','4','A4','5','5','m6','M6','m7','M7','8','8');  // chromatic

var sharpArray = new Array(9);
sharpArray[0] = new Array (0,100,200,300,400,500,600,700,800,900,1000,1100,1200);
sharpArray[1] = new Array (0,113.69,203.91,294.13,407.82,498.04,611.73,701.95,815.64,905.87,996.09,1109.78,1200);
sharpArray[2] = new Array (0,111.74,203.91,315.64,386.31,498.05,603,702,813.69,884.36,1017.6,1088.27,1200);
sharpArray[3] = new Array (0,63.50,189.57,315.64,379.14,505.21,568.72,694.79,758.29,884.36,1010.43,1073.93,1200);
sharpArray[4] = new Array (0,70.67,191.62,312.57,383.24,504.19,574.86,695.81,766.48,887.43,1008.38,1079.05,1200);
sharpArray[5] = new Array (0,76.05,193.16,310.26,386.31,503.42,579.47,696.58,772.63,889.74,1006.84,1082.89,1200);
sharpArray[6] = new Array (0,83.58,195.31,307.04,390.61,502.35,585.92,697.65,781.23,892.96,1004.69,1088.27,1200);
sharpArray[7] = new Array (0,88.59,196.74,304.89,393.48,501.63,590.22,698.37,786.96,895.11,1003.26,1091.85,1200);
sharpArray[8] = new Array (0,94.87,198.53,302.20,397.07,500.73,595.60,699.27,794.13,897.80,1001.47,1096.33,1200);
sharpArray[9] = new Array (0,100,200,300,400,500,600,700,800,900,1000,1100,1200);
sharpArray[10] = new Array (0,86.81,193.16,296.09,386.31,503.42,584.85,696.58,788.76,889.74,1005.22,1082.89,1200);
sharpArray[11] = new Array (0,90.22,192.18,294.14,390.23,498.05,588.27,696.09,792.18,888.27,996.09,1092.18,1200);
sharpArray[12] = new Array (0,91,192,296,387,498,591,696,792,890,996,1092,1200);
sharpArray[13] = new Array (0,90.18,193.16,294.13,386.31,498.04,590.22,696.58,792.18,889.74,996.09,1088.27,1200);
sharpArray[14] = new Array (0,93.69,195.91,298.13,391.82,502.04,591.73,697.96,796.18,893.87,1000.09,1089.78,1200);
var tuningName = new Array('Equal Temperament','Pythagorean Tuning','Natural Tuning','1/3 comma Meantone, Salinas', '2/7 comma Meantone', '1/4 comma Meantone, Aaron', '1/5 comma Meantone', '1/6 comma Meantone, Silbermann', '1/8 comma Meantone', '1/11 comma Meantone','Ordinaire','Werckmeister III','Kirnberger','Kirnberger III','Young')

function generateColorKey () {
  // creates the HTML for the colour key
  var html;
  var fg;
  var innerText;
  html = '<table border="1" cellspacing="0" cellpadding="0" align="center" style="font-size:7.5pt" title="This colour key shows the sharpness or flatness of each note relative to the equivalent interval in the tuning key of C">';
  for (i=14;i>=0;i--) {
    if (i==7) {fg=1; innerText = '<A href="secure/hw.htm" target="_parent"> 0</A>'}
    else if (i==0) {fg=0; innerText = '< -24'}
    else if (i==14) {fg=2; innerText = '> 24'}
    else if (i<7) {fg=0; innerText = '' + ((i-7)*4+3) + ' to '+ ((i-7)*4)}
    else {fg=2; innerText = '' + ((i-7)*4-3) + ' to ' + ((i-7)*4)};
    html += '<TR>';
    html += '<TD align="center" valign="top" width="80%" style="'
    html += 'background-color:#' + color[i] + '; ';
    html += 'border-width:0"' ;

    html += '><SPAN style="'
    html += 'color:' + fgcolor[fg] + '"'
    html += '>' + innerText + '</TD>'
    html += '</TR>';
  }
  html += '</TABLE>';
  return html;
}

function generateTable () {
  // creates the HTML for the table
  var html;
  var interval;
  var tonic;
  var ratio;
  var intRatio;
  var icount;
  var colwidth;
  var bgcol;
  var sharpKey;
  defaultStatus = 'Loading - ' + GetStatus() + "...";
  if (scaleType<2){ colwidth='10%'} else {colwidth='6%'};
  html = '<TABLE cellspacing="0" cellpadding="0" style="font-size:8pt; background-color:lightgrey" border="2" bordercolor="green">';
  // title row
  html += '<TR align="center">'
  html += '<TD style="border-width:0; background-color:green" width="10%" >'
  html += '<SPAN style="color:white">' + scaleName[scaleType] + '</SPAN></TD>';
  icount=0;
  for (j=1;j<=16;j++) {
    if (showColumn(j)) {
      html += '<TD width="' + colwidth + '"'
      html += ' style="border-width:0; background-color:green"';
      html += '><SPAN style="color:white">' + columnTitle[scaleType][j] + '</SPAN></TD>';
      icount++;
    }
  }
  if (scaleType<2) {
    // major/minor
    html += '<TD width="10%" style="border-width:0; background-color:green">'
    html += '<SPAN style="color:white">'
    if (scaleType==0) { html += 'Rel Min' }
    else { html += 'Rel Maj' };
    html += '</SPAN></TD>'
  }
  html += '</TR>';
  // data rows
  for (i=1;i<=13;i++) {
    tonic = ((homeKey+7-i)*7)%12;
    html += '<TR style="background-color:lightgrey; border-color:white">';
    html += '<TD align="center" style="'
    if (i==7) {html += 'border-width:1 0 '}
    else {html += 'border-width:0 '};
    html += '"><A href="javascript:newHomeKey(' + getKey(homeKey+7-i) + ',' + scaleType + ')"';
    html += ' title="set home key to ' + keyName[homeKey+7-i] + ' ' + scaleName[scaleType] + '"'
    html += ' style="text-decoration:none">' + keyName[homeKey+7-i] +'</A></TD>';
    if (homeKey+7-i>=12) {sharpKey=true} else {sharpKey=false};
    for (j=1;j<=16;j++) {
      if (showColumn(j)) {
        interval = scaleArray[scaleType][j]; ;
        diff = getCents(tuning, tonic+interval) - getCents(tuning, tonic);
        if (relType==0) {ratio = diff - getCents(tuning, interval)}
        else if (relType==1) {ratio = diff - getCents(0, interval)}
        else if (relType==3) {ratio = diff - getCents(2, interval)}
        else {ratio = diff - getCents(relTuning, interval)};
        // The following rounds -23.46 to -24 so that the Pythagorean Comma looks right
        intRatio = Math.round(Math.round(Math.abs(ratio)*10)/10);
        if (ratio < 0) { intRatio = -1 * intRatio };
        html += '<TD align="center" ';
        // 31 Oct Removed Audio
        //html += ' onmousedown="soundNote(' + getCents(tuning, tonic) + ', ' + getCents(tuning, tonic+interval) + ', ' + tuning + ')" ';
        //html += ' onmouseup="soundNote(' +  getCents(tuning, tonic) + ', ' +  (getCents(tuning, tonic+interval)-ratio) + ', ' + relTuning + ')" ';
        html += 'title="' + getNoteTitle(tonic, interval, sharpKey, diff, ratio) +'" '
        if (intRatio > 24) {bgcol = 7}
        else if (intRatio < -24) {bgcol = -7}
        else if (Math.round(intRatio*10)==0) {bgcol = 0}
        else if (ratio>0) {bgcol = Math.ceil(intRatio/4)}
        else {bgcol = Math.ceil(Math.abs(intRatio)/4) * -1}
        bgcol += 7;
        html += 'style="background-color:#' + color[bgcol] + ';'
        if (i==7) {html += 'border-width:1 0 '}
        else {html += 'border-width:0 '};
        html +='">'
        html += '<SPAN style="color:';
        if (intRatio==0) {html += fgcolor[1]}
        else {html += fgcolor[intRatio/Math.abs(intRatio)+1]};
        html += '">' + pick(display, intRatio, diff, tonic, interval, sharpKey) + '</SPAN></TD>';
      }
    }
    if (scaleType<2) {
      // major/minor so show additional columns
      if (scaleType==0) {
        html += '<TD align="center" style="'
        if (i==7) {html += 'border-width:1 0 '}
        else {html += 'border-width:0 '};
        html += '"><A href="javascript:newHomeKey(' + getKey(homeKey+10-i) + ',1)"';
        html += ' title="set home key to ' + keyName[homeKey+10-i] + ' Minor"'
        html += ' style="text-decoration:none">' + keyName[getKey(homeKey+10-i)] +'</A></TD>';
      }
      else {
        html += '<TD align="center" style="'
        if (i==7) {html += 'border-width:1 0 '}
        else {html += 'border-width:0 '};
        html += '"><A href="javascript:newHomeKey(' + getKey(homeKey+4-i) + ',0)"';
        html += ' title="set home key to ' + keyName[homeKey+4-i] + ' Major"'
        html += ' style="text-decoration:none">' + keyName[getKey(homeKey+4-i)] +'</A></TD>';
      }
    }
    html += '</TR>';
  }
  html += '</TABLE>';
  defaultStatus = GetStatus();
  return html;
}

function getCents(t, note) {
  // reads pitch from the current tuning array.  Parameter has range
  // 0-24 (2 octaves) to enable calc of interval from any pair of notes
  if (note>12) {return 1200 + sharpArray[t][note-12]}
  else {return sharpArray[t][note]}
}

function getKey(key) {
  // constrain to range Db to F# (all other keys are enharmonics)
  return ((key+17)%12)+7;
}

function getNote(tonic, interval, sharpKey) {
  if ((interval==11) || sharpKey) {return sharpName[(tonic+interval)%12]}
  else {return flatName[(tonic+interval)%12]};
}

function getNoteTitle (tonic, interval, sharpKey, diff, ratio) {
  var retVal;
  retVal = '' + getNote(tonic, interval, sharpKey) + ' is '
  retVal += (Math.round(diff*100)/100) + ' cents relative to the tonic'
  retVal += ' and ' + (Math.round(ratio*100)/100) + ' relative to the same note in the tuning key. '
  // 31 Oct Removed sound
  //retVal += 'Click left mouse button to hear the interval and release to hear the relative interval.'
  return retVal;
}

function GetStatus () {
  var retval;
  retVal = tuningName[tuning];
  if (relType==0) {retVal += ' relative to itself.'}
  else if (relType==1) {retVal += ' relative to Equal Temperament.'}
  else if (relType==3) {retVal += ' relative to Natural Tuning.'}
  else {retVal += ' relative to ' + tuningName[relTuning]}
  return retVal + ' - Home key: ' + keyName[homeKey] + ' ' + scaleName[scaleType]
}

function soundNote(tonic, interval, t) {
  // Removed sound 31 Oct 2010
  //document.getElementById("audio").makeSound(tonic, interval);
  defaultStatus = Math.round(tonic) +  " - " + Math.round(interval) + ' (' + tuningName[t] + ')'
}

function pick(sel, a, b, tonic, interval, sharpKey) {

  if (sel==1 ) { return a }
  else if (sel==2) {return Math.round(b)}
  else return getNote(tonic, interval, sharpKey);
}

function showColumn(column) {
  // returns true if a column should be displayed for the current
  // scale (chromatic, major, minor)
  if (column==1) {return true}
  else {
    if (scaleArray[scaleType][column] == scaleArray[scaleType][column-1]) {return false}
    else {return true}
  }
}
function newHomeKey(newKey, newScale) {
  // switch to new home key, but constrain to range Db to F# (all other keys are enharmonics)
  homeKey = newKey;
  scaleType = newScale;
  document.getElementById("scaletype" + newScale).checked = true;
  document.getElementById("tablediv").innerHTML = generateTable();
}

function setDisplay(d) {
  display = d;
  document.getElementById("tablediv").innerHTML = generateTable();
}

function setOptions(pTuning, pRelTuning, pScaleType, pDisplay) {
  homeKey = 12;
  tuning = pTuning;
  document.getElementById("tuning").value = pTuning;
  relTuning =pRelTuning;
  document.getElementById("reltuning").value = pRelTuning;
  scaleType = pScaleType;
  document.getElementById("scaletype" + pScaleType).checked = true;
  relType = 2;
  document.getElementById("reltype3").checked = true;
  display = pDisplay;
  document.getElementById("display" + pDisplay).checked = true;
  document.getElementById("tablediv").innerHTML = generateTable();
}

function setRelTuning(t) {
  relTuning = t;
  // Force the reltype radio button to the 'relative to' option enable the new tuning
  relType = 2;
  document.getElementById("reltype3").checked = true;
  document.getElementById("tablediv").innerHTML = generateTable();
}
function setRelType(t) {
  relType = t;
  if (t==1)
    {document.getElementById("reltuning").value = 0;
    relTuning = 0}
  else if (t==3)
    {document.getElementById("reltuning").value = 2
    relTuning = 2}
  else if (t==0)
    {document.getElementById("reltuning").value = tuning;
    relTuning = tuning};
  document.getElementById("tablediv").innerHTML = generateTable();
}

function setScaleType(s) {
  scaleType = s;
  document.getElementById("tablediv").innerHTML = generateTable();
}

function setTuning(t) {
  tuning = t;
  if (relType==0)
    {document.getElementById("reltuning").value = tuning;
    relTuning = tuning};
  document.getElementById("tablediv").innerHTML = generateTable();
}
</SCRIPT>
</HEAD>
<BODY style="background-color:#99FF99; font-family:arial; font-size:7pt" link="blue" vlink="darkblue" alink="darkblue">
<SCRIPT>// Prevent this page being loaded without the supporting frameset
if (top==self) {self.location.href = 'index.html'}
</SCRIPT>
  <FORM>
  <span style="font-family:arial; font-size:7pt">
    <TABLE height="100%" width="100%" border="0" valign="top">
      <TR>
      <!-- 31 Oct Removed Audio
      <TD width="2%">
      <applet name="audio" code="Audio.class" width="0" height="0"></applet>
      </TD>-->
        <TD width="32%" align="center">

          <TABLE border="1" style="background-color:lightgrey" title="Use this control panel to change the settings for the Musical Calculator on the right">
            <TR>
              <TD valign="center" align="center" style="background-color:green; color:white; font-family:arial; font-size:8pt">Control Panel
              </TD>
            </TR>
            <TR>
              <TD style="font-family:arial; font-size:8pt">
                <INPUT id="scaletype0" type="radio" name="scaletype" checked onclick="setScaleType(0)">Major
                <INPUT id="scaletype1" type="radio" name="scaletype" onclick="setScaleType(1)">Minor
                <INPUT id="scaletype2" type="radio" name="scaletype" onclick="setScaleType(2)">Chromatic
              </TD>
            </TR>
            <TR>
              <TD style="font-family:arial; font-size:8pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tuning:
                <SELECT id="tuning" name="tuning" onChange="setTuning(this.value)" style="font-family:arial; font-size:8pt">
                  <OPTION value="0" selected>Equal Temperament
                  <OPTION value="1">Pythagorean Tuning
                  <OPTION value="2">Natural Tuning
                  <OPTION value="3">1/3 comma Meantone
                  <OPTION value="4">2/7 comma Meantone
                  <OPTION value="5">1/4 comma Meantone
                  <OPTION value="6">1/5 comma Meantone
                  <OPTION value="7">1/6 comma Meantone
                  <OPTION value="8">1/8 comma Meantone
                  <OPTION value="9">1/11 comma Meantone
                  <OPTION value="10">Ordinaire
                  <OPTION value="11">Werckmeister III
                  <OPTION value="12">Kirnberger
                  <OPTION value="13">Kirnberger III
                  <OPTION value="14">Young
                </SELECT>
              </TD>
            </TR>
            <TR>
              <TD style="font-family:arial; font-size:8pt">
                <INPUT type="radio" id="reltype0" name="reltype" checked onclick="setRelType(0)">Relative to Self<BR>
                <INPUT type="radio" id="reltype1" name="reltype" onclick="setRelType(1)">Relative to Equal Temperament<BR>
                <INPUT type="radio" id="reltype2" name="reltype" onclick="setRelType(3)">Relative to Natural Tuning<BR>
                <INPUT type="radio" id="reltype3" name="reltype" onclick="setRelType(2)">Rel. to:
                <SELECT id="reltuning" name="reltuning" onChange="setRelTuning(this.value)" style="font-family:arial; font-size:8pt">
                  <OPTION value="0" selected>Equal Temperament
                  <OPTION value="1">Pythagorean Tuning
                  <OPTION value="2">Natural Tuning
                  <OPTION value="3">1/3 comma Meantone
                  <OPTION value="4">2/7 comma Meantone
                  <OPTION value="5">1/4 comma Meantone
                  <OPTION value="6">1/5 comma Meantone
                  <OPTION value="7">1/6 comma Meantone
                  <OPTION value="8">1/8 comma Meantone
                  <OPTION value="9">1/11 comma Meantone
                  <OPTION value="10">Ordinaire
                  <OPTION value="11">Werckmeister III
                  <OPTION value="12">Kirnberger
                  <OPTION value="13">Kirnberger III
                  <OPTION value="14">Young
                </SELECT>
              </TD>
            </TR>
            <TR>
              <TD style="font-family:arial; font-size:8pt">
                <INPUT type="radio" id="display1" name="display" onclick="setDisplay(1)">Cents/Tuning Key
                <INPUT type="radio" id="display2" name="display" onclick="setDisplay(2)">Cents/Tonic
                <INPUT type="radio" id="display3" name="display" onclick="setDisplay(3)" checked >Note
              </TD>
            </TR>
          </TABLE>

        </TD>
        <TD width="54%" align="center" valign="center">
          <DIV id="tablediv">The Musical Calculator should appear here after a few seconds.  If nothing happens then you will need to upgrade to Internet Explorer Version 5 (<a href="http://www.microsoft.com/windows/ie" target="_top">Upgrade Internet Explorer</a>), Netscape Navigator Version 6 (<a href="http://browsers.netscape.com/browsers" target="_top">Upgrade Netscape Navigator</a>), or an alternative browser which supports Dynamic HTML to W3C standards.
          </DIV>
        </TD>
        <TD width="8%" align="center" valign="center">

          <DIV id="colorkeydiv">
          </DIV>

        </TD>
    </TABLE>
    </span>
  </FORM>
<SCRIPT>// initial load of diagram and colour chart
document.getElementById("tablediv").innerHTML = generateTable();
document.getElementById("colorkeydiv").innerHTML = generateColorKey();
</SCRIPT>

</BODY>
